# MVP 2.0 è¯¦ç»†è§„åˆ’æ–¹æ¡ˆ - ç¬¬ä¸‰åˆ°ç¬¬ä¸ƒéƒ¨åˆ†

> æœ¬æ–‡æ¡£æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„ç»­ç¯‡ï¼ŒåŒ…å«æŠ¥å‘Šç”Ÿæˆã€æ•°æ®è¡¥å…¨ã€æŠ€æœ¯å®æ–½ã€4å‘¨è®¡åˆ’å’Œæ–‡æ¡£æ›´æ–°

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸“ä¸šæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

## 3.1 æŠ¥å‘Šè´¨é‡æ ‡å‡†ï¼ˆå¯¹æ ‡ç›Šå®¶ä¹‹å® ï¼‰

### ç›Šå®¶ä¹‹å® æŠ¥å‘Šåˆ†æ

**æŠ¥å‘Šç»“æ„**ï¼ˆ30,000å­—æ ‡å‡†ï¼‰ï¼š
```
1. å°é¢é¡µ
   - é¡¹ç›®åç§°ã€å®¢æˆ·ã€ç”Ÿæˆæ—¥æœŸã€GECOMç‰ˆæœ¬

2. æ‰§è¡Œæ‘˜è¦ (1é¡µ)
   - æ ¸å¿ƒå‘ç°3-5æ¡
   - å…³é”®æ•°å­—ï¼ˆæ¯›åˆ©ç‡ã€ROIã€å›æœ¬å‘¨æœŸï¼‰
   - æˆ˜ç•¥å»ºè®®Top 3

3. ç¬¬ä¸€ç« ï¼šé¡¹ç›®æ¦‚è¿° (2-3é¡µ)
   - 1.1 é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡
   - 1.2 GECOM-Petæ¡†æ¶æ¦‚è§ˆ
   - 1.3 ç ”ç©¶èŒƒå›´ä¸æ–¹æ³•è®º
   - 1.4 æ•°æ®æ¥æºä¸è´¨é‡è¯´æ˜

4. ç¬¬äºŒç« ï¼šæˆæœ¬ç»“æ„å…¨æ‹†è§£ (10-15é¡µ)
   - 2.1 CAPEXåˆ†æï¼ˆM1-M3ï¼‰
   - 2.2 OPEXåˆ†æï¼ˆM4-M8ï¼‰
   - 2.3 å•ä½ç»æµæ¨¡å‹
   - 2.4 æˆæœ¬é©±åŠ¨å› ç´ è¯†åˆ«

5. ç¬¬ä¸‰ç« ï¼šç›ˆåˆ©èƒ½åŠ›åˆ†æ (5-8é¡µ)
   - 3.1 æ¯›åˆ©ç‡åˆ†æ
   - 3.2 ROIä¸å›æœ¬å‘¨æœŸ
   - 3.3 æ•æ„Ÿæ€§åˆ†æ
   - 3.4 ç›ˆäºå¹³è¡¡åˆ†æ

6. ç¬¬å››ç« ï¼šä¼˜åŒ–å»ºè®® (3-5é¡µ)
   - 4.1 å®šä»·ç­–ç•¥ä¼˜åŒ–
   - 4.2 æˆæœ¬å‰Šå‡è·¯å¾„
   - 4.3 å¸‚åœºé€‰æ‹©å»ºè®®
   - 4.4 å®æ–½è·¯çº¿å›¾

7. é™„å½•Aï¼šè¯¦ç»†æ•°æ®è¡¨ (5-10é¡µ)
   - é™„è¡¨1: M1-M8æ¨¡å—æ˜ç»†ï¼ˆæŒ‰å›½å®¶ï¼‰
   - é™„è¡¨2: æˆæœ¬å› å­æ¸…å•
   - é™„è¡¨3: è®¡ç®—å…¬å¼æ±‡æ€»

8. é™„å½•Bï¼šæ•°æ®æº¯æº (2-3é¡µ)
   - Tier 1æ•°æ®æºï¼ˆå®˜æ–¹ï¼Œç½®ä¿¡åº¦100%ï¼‰
   - Tier 2æ•°æ®æºï¼ˆæƒå¨ï¼Œç½®ä¿¡åº¦90%ï¼‰
   - Tier 3æ•°æ®æºï¼ˆä¼°ç®—ï¼Œç½®ä¿¡åº¦80%ï¼‰

9. é™„å½•Cï¼šæœ¯è¯­è¡¨ä¸è¯´æ˜
   - GECOMæ¡†æ¶æœ¯è¯­
   - è¡Œä¸šä¸“æœ‰åè¯
```

### MVP 2.0æŠ¥å‘Šç›®æ ‡

**å¿…é¡»è¾¾åˆ°**ï¼š
- âœ… å®Œæ•´ç« èŠ‚ç»“æ„ï¼ˆ1-9ç« ï¼‰
- âœ… ä¸“ä¸šæ’ç‰ˆï¼ˆç›®å½•ã€é¡µç ã€è¡¨æ ¼ç¼–å·ï¼‰
- âœ… æ•°æ®å¯è§†åŒ–ï¼ˆæˆæœ¬é¥¼å›¾ã€æŸ±çŠ¶å›¾ã€è¶‹åŠ¿å›¾ï¼‰
- âœ… æ•°æ®æº¯æºæ ‡è¯†ï¼ˆæ¯ä¸ªæ•°æ®ç‚¹çš„Tierçº§åˆ«ï¼‰
- âœ… AIç”Ÿæˆä¼˜åŒ–å»ºè®®ï¼ˆåŸºäºDeepSeek R1ï¼‰

**å¯ä»¥ç®€åŒ–**ï¼ˆv2.0ï¼‰ï¼š
- æ•æ„Ÿæ€§åˆ†æï¼ˆå¯æ‰‹åŠ¨ï¼Œä¸å¿…è‡ªåŠ¨ç”Ÿæˆï¼‰
- å¤šSKUå¹¶è¡Œå¯¹æ¯”ï¼ˆv3.0å†å®ç°ï¼‰
- å®æ—¶æ•°æ®æ›´æ–°ï¼ˆv2.0ç”¨é™æ€snapshotï¼‰

---

## 3.2 æŠ¥å‘Šæ¨¡æ¿è®¾è®¡

### æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å†³ç­– |
|------|------|------|------|
| jsPDF | çº¯å‰ç«¯ç”Ÿæˆï¼Œæ— éœ€åç«¯ | æ’ç‰ˆå¤æ‚ï¼Œè¡¨æ ¼éš¾å¤„ç† | âŒ |
| React-PDF | ç»„ä»¶åŒ–ï¼Œæ˜“ç»´æŠ¤ | æ–‡ä»¶ä½“ç§¯å¤§ï¼Œæ€§èƒ½å·® | âŒ |
| Puppeteerï¼ˆæœåŠ¡ç«¯ï¼‰ | å®Œç¾æ’ç‰ˆï¼Œæ”¯æŒCSS | éœ€è¦åç«¯ï¼Œéƒ¨ç½²å¤æ‚ | âŒ |
| **docx.js + æ¨¡æ¿** | ç”ŸæˆWordï¼Œç”¨æˆ·å¯ç¼–è¾‘ | æ ¼å¼å—é™ | âœ… é‡‡ç”¨ |

**æœ€ç»ˆæ–¹æ¡ˆ**ï¼šä½¿ç”¨`docx.js`ç”ŸæˆWordæ ¼å¼æŠ¥å‘Šï¼ˆ.docxï¼‰ï¼Œä¼˜åŠ¿ï¼š
1. ç”¨æˆ·å¯åœ¨Wordä¸­ç¼–è¾‘å’ŒäºŒæ¬¡æ’ç‰ˆ
2. æ”¯æŒè¡¨æ ¼ã€å›¾ç‰‡ã€æ ·å¼
3. çº¯å‰ç«¯ç”Ÿæˆï¼Œæ— éœ€åç«¯
4. æ–‡ä»¶ä½“ç§¯å°

### æŠ¥å‘Šæ¨¡æ¿ä»£ç è®¾è®¡

```typescript
// lib/report-generator.ts
import { Document, Paragraph, TextRun, Table, TableRow, TableCell, ImageRun } from 'docx';
import { saveAs } from 'file-saver';

/**
 * ç”ŸæˆGECOMæˆæœ¬æŠ¥å‘Šï¼ˆWordæ ¼å¼ï¼‰
 */
export async function generateGECOMReport(
  project: Project,
  calculation: Calculation,
  costResult: CostResult,
  costFactor: CostFactor
): Promise<void> {
  const doc = new Document({
    sections: [
      {
        properties: {},
        children: [
          // å°é¢é¡µ
          ...generateCoverPage(project),

          // æ‰§è¡Œæ‘˜è¦
          ...generateExecutiveSummary(costResult),

          // ç¬¬ä¸€ç« ï¼šé¡¹ç›®æ¦‚è¿°
          ...generateChapter1(project, calculation),

          // ç¬¬äºŒç« ï¼šæˆæœ¬æ‹†è§£
          ...generateChapter2(costResult, costFactor),

          // ç¬¬ä¸‰ç« ï¼šç›ˆåˆ©èƒ½åŠ›åˆ†æ
          ...generateChapter3(costResult),

          // ç¬¬å››ç« ï¼šä¼˜åŒ–å»ºè®®ï¼ˆAIç”Ÿæˆï¼‰
          ...await generateChapter4WithAI(costResult, costFactor),

          // é™„å½•Aï¼šæ•°æ®æ˜ç»†
          ...generateAppendixA(costResult, costFactor),

          // é™„å½•Bï¼šæ•°æ®æº¯æº
          ...generateAppendixB(costFactor),
        ],
      },
    ],
  });

  // ç”Ÿæˆå¹¶ä¸‹è½½
  const blob = await Packer.toBlob(doc);
  saveAs(blob, `GECOMæˆæœ¬æŠ¥å‘Š_${project.name}_${new Date().toISOString().split('T')[0]}.docx`);
}

/**
 * å°é¢é¡µ
 */
function generateCoverPage(project: Project): Paragraph[] {
  return [
    new Paragraph({
      text: 'GECOMå…¨çƒç”µå•†æˆæœ¬æµ‹ç®—æŠ¥å‘Š',
      heading: HeadingLevel.TITLE,
      alignment: AlignmentType.CENTER,
      spacing: { before: 200, after: 200 },
    }),
    new Paragraph({
      text: project.name,
      heading: HeadingLevel.HEADING_1,
      alignment: AlignmentType.CENTER,
    }),
    new Paragraph({
      text: `ç›®æ ‡å¸‚åœº: ${getCountryName(project.target_country)}`,
      alignment: AlignmentType.CENTER,
      spacing: { before: 100 },
    }),
    new Paragraph({
      text: `ç”Ÿæˆæ—¥æœŸ: ${new Date().toLocaleDateString('zh-CN')}`,
      alignment: AlignmentType.CENTER,
    }),
    new Paragraph({
      text: `ç‰ˆæœ¬: GECOM v2.0 | æ•°æ®ç‰ˆæœ¬: ${calculation.cost_factor_version}`,
      alignment: AlignmentType.CENTER,
      spacing: { after: 400 },
    }),
    new Paragraph({
      text: 'ğŸ¤– Generated with GECOMæ™ºèƒ½æˆæœ¬åŠ©æ‰‹',
      alignment: AlignmentType.CENTER,
      italics: true,
    }),
  ];
}

/**
 * æ‰§è¡Œæ‘˜è¦
 */
function generateExecutiveSummary(costResult: CostResult): Paragraph[] {
  const margin = costResult.unit_economics.gross_margin;
  const isProfitable = margin >= 0;

  return [
    new Paragraph({
      text: 'æ‰§è¡Œæ‘˜è¦',
      heading: HeadingLevel.HEADING_1,
      pageBreakBefore: true,
    }),
    new Paragraph({
      text: 'æ ¸å¿ƒå‘ç°',
      heading: HeadingLevel.HEADING_2,
    }),
    new Paragraph({
      children: [
        new TextRun({
          text: `1. ç›ˆåˆ©èƒ½åŠ›: `,
          bold: true,
        }),
        new TextRun({
          text: `å½“å‰æ¯›åˆ©ç‡${margin.toFixed(1)}%ï¼Œ${isProfitable ? 'âœ… å¯ç›ˆåˆ©' : 'âŒ äºæŸ'}`,
          color: isProfitable ? '10B981' : 'EF4444',
        }),
      ],
    }),
    new Paragraph({
      children: [
        new TextRun({
          text: `2. æŠ•èµ„å›æŠ¥: `,
          bold: true,
        }),
        new TextRun({
          text: `ROI ${costResult.kpis.roi.toFixed(1)}%ï¼Œå›æœ¬å‘¨æœŸ${costResult.kpis.payback_period_months.toFixed(1)}ä¸ªæœˆ`,
        }),
      ],
    }),
    new Paragraph({
      children: [
        new TextRun({
          text: `3. æˆæœ¬é©±åŠ¨: `,
          bold: true,
        }),
        new TextRun({
          text: `æœ€å¤§æˆæœ¬é¡¹ä¸º${getLargestCostDriver(costResult)}ï¼Œå æ€»æˆæœ¬${getLargestCostDriverPercentage(costResult)}%`,
        }),
      ],
    }),

    new Paragraph({
      text: 'æˆ˜ç•¥å»ºè®®Top 3',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 200 },
    }),
    // è¿™é‡Œå°†æ’å…¥AIç”Ÿæˆçš„å»ºè®®
    new Paragraph({
      text: 'ï¼ˆè¯¦è§ç¬¬å››ç« ï¼šä¼˜åŒ–å»ºè®®ï¼‰',
      italics: true,
    }),
  ];
}

/**
 * ç¬¬äºŒç« ï¼šæˆæœ¬æ‹†è§£
 */
function generateChapter2(costResult: CostResult, costFactor: CostFactor): Paragraph[] {
  return [
    new Paragraph({
      text: 'ç¬¬äºŒç« ï¼šæˆæœ¬ç»“æ„å…¨æ‹†è§£',
      heading: HeadingLevel.HEADING_1,
      pageBreakBefore: true,
    }),

    // 2.1 CAPEXåˆ†æ
    new Paragraph({
      text: '2.1 CAPEXåˆ†æï¼ˆä¸€æ¬¡æ€§æˆæœ¬ï¼‰',
      heading: HeadingLevel.HEADING_2,
    }),
    generateCAPEXTable(costResult.capex),

    // 2.2 OPEXåˆ†æ
    new Paragraph({
      text: '2.2 OPEXåˆ†æï¼ˆå•ä½è¿è¥æˆæœ¬ï¼‰',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 300 },
    }),
    new Paragraph({
      text: 'M4: è´§ç‰©ç¨è´¹',
      heading: HeadingLevel.HEADING_3,
    }),
    generateOPEXTable_M4(costResult.opex, costFactor),

    new Paragraph({
      text: 'M5: ç‰©æµé…é€',
      heading: HeadingLevel.HEADING_3,
    }),
    generateOPEXTable_M5(costResult.opex, costFactor),

    // M6-M8ç±»ä¼¼...

    // 2.3 å•ä½ç»æµæ¨¡å‹
    new Paragraph({
      text: '2.3 å•ä½ç»æµæ¨¡å‹',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 300 },
    }),
    generateUnitEconomicsTable(costResult.unit_economics),
  ];
}

/**
 * CAPEXè¡¨æ ¼
 */
function generateCAPEXTable(capex: CostResult['capex']): Table {
  return new Table({
    rows: [
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('æ¨¡å—')] }),
          new TableCell({ children: [new Paragraph('é¡¹ç›®')] }),
          new TableCell({ children: [new Paragraph('é‡‘é¢ (USD)')] }),
          new TableCell({ children: [new Paragraph('æ•°æ®æ¥æº')] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('M1')] }),
          new TableCell({ children: [new Paragraph('å¸‚åœºå‡†å…¥')] }),
          new TableCell({ children: [new Paragraph(`$${capex.m1.toFixed(2)}`)] }),
          new TableCell({ children: [new Paragraph('Tier 2')] }),
        ],
      }),
      // M2, M3ç±»ä¼¼...
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph({ text: 'CAPEXæ€»è®¡', bold: true })] }),
          new TableCell({ children: [] }),
          new TableCell({ children: [new Paragraph({ text: `$${capex.total.toFixed(2)}`, bold: true })] }),
          new TableCell({ children: [] }),
        ],
      }),
    ],
  });
}

/**
 * M4è¡¨æ ¼ï¼ˆåŒ…å«æ•°æ®æº¯æºï¼‰
 */
function generateOPEXTable_M4(opex: CostResult['opex'], costFactor: CostFactor): Table {
  return new Table({
    rows: [
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('æˆæœ¬é¡¹')] }),
          new TableCell({ children: [new Paragraph('é‡‘é¢ (USD/å•ä½)')] }),
          new TableCell({ children: [new Paragraph('è®¡ç®—è¯´æ˜')] }),
          new TableCell({ children: [new Paragraph('æ•°æ®æ¥æº')] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('COGS')] }),
          new TableCell({ children: [new Paragraph(`$${opex.m4_cogs.toFixed(2)}`)] }),
          new TableCell({ children: [new Paragraph('ç”¨æˆ·è¾“å…¥')] }),
          new TableCell({ children: [new Paragraph('-')] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('è¿›å£å…³ç¨')] }),
          new TableCell({ children: [new Paragraph(`$${opex.m4_tariff.toFixed(2)}`)] }),
          new TableCell({ children: [new Paragraph(`COGS Ã— ${(costFactor.m4_effective_tariff_rate * 100).toFixed(1)}%`)] }),
          new TableCell({ children: [new Paragraph(costFactor.m4_tariff_data_source)] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('å¤´ç¨‹ç‰©æµ')] }),
          new TableCell({ children: [new Paragraph(`$${opex.m4_logistics.toFixed(2)}`)] }),
          new TableCell({ children: [new Paragraph('ç©ºè¿/æµ·è¿è´¹ç‡ Ã— äº§å“é‡é‡')] }),
          new TableCell({ children: [new Paragraph('tier2_authoritative')] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('VAT/GST')] }),
          new TableCell({ children: [new Paragraph(`$${opex.m4_vat.toFixed(2)}`)] }),
          new TableCell({ children: [new Paragraph(`(COGS + ç‰©æµ + å…³ç¨) Ã— ${(costFactor.m4_vat_rate * 100).toFixed(1)}%`)] }),
          new TableCell({ children: [new Paragraph(costFactor.m4_vat_data_source)] }),
        ],
      }),
    ],
  });
}

/**
 * ç¬¬å››ç« ï¼šAIç”Ÿæˆä¼˜åŒ–å»ºè®®
 */
async function generateChapter4WithAI(
  costResult: CostResult,
  costFactor: CostFactor
): Promise<Paragraph[]> {
  // è°ƒç”¨DeepSeek R1ç”Ÿæˆä¼˜åŒ–å»ºè®®
  const aiSuggestions = await callDeepSeekR1ForOptimization(costResult, costFactor);

  return [
    new Paragraph({
      text: 'ç¬¬å››ç« ï¼šä¼˜åŒ–å»ºè®®',
      heading: HeadingLevel.HEADING_1,
      pageBreakBefore: true,
    }),
    new Paragraph({
      text: 'ï¼ˆæœ¬ç« èŠ‚ç”±AIæ™ºèƒ½åŠ©æ‰‹åŸºäºDeepSeek R1ç”Ÿæˆï¼‰',
      italics: true,
      spacing: { after: 200 },
    }),

    new Paragraph({
      text: '4.1 å®šä»·ç­–ç•¥ä¼˜åŒ–',
      heading: HeadingLevel.HEADING_2,
    }),
    new Paragraph({
      text: aiSuggestions.pricing,
    }),

    new Paragraph({
      text: '4.2 æˆæœ¬å‰Šå‡è·¯å¾„',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 200 },
    }),
    new Paragraph({
      text: aiSuggestions.cost_reduction,
    }),

    new Paragraph({
      text: '4.3 å¸‚åœºé€‰æ‹©å»ºè®®',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 200 },
    }),
    new Paragraph({
      text: aiSuggestions.market_selection,
    }),

    new Paragraph({
      text: '4.4 å®æ–½è·¯çº¿å›¾',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 200 },
    }),
    new Paragraph({
      text: aiSuggestions.implementation_roadmap,
    }),
  ];
}

/**
 * è°ƒç”¨DeepSeek R1ç”Ÿæˆä¼˜åŒ–å»ºè®®
 */
async function callDeepSeekR1ForOptimization(
  costResult: CostResult,
  costFactor: CostFactor
): Promise<{
  pricing: string;
  cost_reduction: string;
  market_selection: string;
  implementation_roadmap: string;
}> {
  const prompt = `ä½ æ˜¯GECOMå…¨çƒç”µå•†æˆæœ¬ä¼˜åŒ–ä¸“å®¶ã€‚è¯·åŸºäºä»¥ä¸‹æˆæœ¬åˆ†ææ•°æ®ï¼Œç”Ÿæˆä¸“ä¸šçš„ä¼˜åŒ–å»ºè®®ï¼š

## å½“å‰æˆæœ¬ç»“æ„
- å•ä½æ”¶å…¥: $${costResult.unit_economics.revenue}
- å•ä½æˆæœ¬: $${costResult.unit_economics.cost}
- æ¯›åˆ©ç‡: ${costResult.unit_economics.gross_margin.toFixed(1)}%
- ROI: ${costResult.kpis.roi.toFixed(1)}%
- å›æœ¬å‘¨æœŸ: ${costResult.kpis.payback_period_months.toFixed(1)}æœˆ

## æˆæœ¬æ‹†è§£
- M4å…³ç¨: $${costResult.opex.m4_tariff} (${(costFactor.m4_effective_tariff_rate * 100).toFixed(1)}%ç¨ç‡)
- M4ç‰©æµ: $${costResult.opex.m4_logistics}
- M5é…é€: $${costResult.opex.m5_last_mile}
- M6è¥é”€: $${costResult.opex.m6_marketing}
- M7ä½£é‡‘: $${costResult.opex.m7_platform_commission}

è¯·ç”Ÿæˆ4ä¸ªéƒ¨åˆ†çš„ä¼˜åŒ–å»ºè®®ï¼š
1. å®šä»·ç­–ç•¥ä¼˜åŒ–ï¼ˆå¦‚ä½•è°ƒæ•´å®šä»·å®ç°ç›®æ ‡æ¯›åˆ©ç‡ï¼‰
2. æˆæœ¬å‰Šå‡è·¯å¾„ï¼ˆå“ªäº›æˆæœ¬å¯ä»¥ä¼˜åŒ–ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼‰
3. å¸‚åœºé€‰æ‹©å»ºè®®ï¼ˆæ˜¯å¦å»ºè®®åˆ‡æ¢å¸‚åœºï¼‰
4. å®æ–½è·¯çº¿å›¾ï¼ˆçŸ­æœŸ/ä¸­æœŸ/é•¿æœŸè¡ŒåŠ¨è®¡åˆ’ï¼‰

è¦æ±‚ï¼š
- æ¯éƒ¨åˆ†200-300å­—
- å…·ä½“å¯æ‰§è¡Œï¼ŒåŒ…å«æ•°å­—å’Œæ­¥éª¤
- ä¸“ä¸šä½†æ˜“æ‡‚
- ä¸­æ–‡è¾“å‡º`;

  const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${process.env.DEEPSEEK_API_KEY}`,
    },
    body: JSON.stringify({
      model: 'deepseek-reasoner',
      messages: [
        {
          role: 'user',
          content: prompt,
        },
      ],
    }),
  });

  const data = await response.json();
  const content = data.choices[0].message.content;

  // è§£æAIè¿”å›çš„å†…å®¹ï¼ˆå‡è®¾AIæŒ‰æ ¼å¼è¿”å›ï¼‰
  const sections = parseAIResponse(content);

  return sections;
}
```

---

## 3.3 æŠ¥å‘Šç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆï¼ˆå®Œæ•´æµç¨‹ï¼‰

### æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"æŒ‰é’®
    â†“
Step 1: æ”¶é›†æ•°æ®
    - é¡¹ç›®ä¿¡æ¯ (project)
    - è®¡ç®—ç»“æœ (costResult)
    - æˆæœ¬å› å­ (costFactor)
    - ç”¨æˆ·è¦†ç›–å€¼ (userOverrides)
    â†“
Step 2: ç”Ÿæˆå›¾è¡¨ï¼ˆè½¬ä¸ºå›¾ç‰‡ï¼‰
    - ä½¿ç”¨html2canvaså°†Rechartså›¾è¡¨è½¬ä¸ºPNG
    - æˆæœ¬é¥¼å›¾
    - æˆæœ¬æŸ±çŠ¶å›¾
    - æ¯›åˆ©ç‡è¶‹åŠ¿å›¾
    â†“
Step 3: è°ƒç”¨AIç”Ÿæˆå»ºè®®
    - è°ƒç”¨DeepSeek R1ç”Ÿæˆç¬¬å››ç« å†…å®¹
    - è§£æAIè¿”å›çš„å»ºè®®æ–‡æœ¬
    â†“
Step 4: ç»„è£…Wordæ–‡æ¡£
    - ä½¿ç”¨docx.jsç”ŸæˆDocumentå¯¹è±¡
    - æ·»åŠ å°é¢ã€ç›®å½•ã€ç« èŠ‚
    - æ’å…¥è¡¨æ ¼ã€å›¾ç‰‡
    â†“
Step 5: ç”Ÿæˆå¹¶ä¸‹è½½
    - Packer.toBlob()ç”Ÿæˆ.docxæ–‡ä»¶
    - FileSaver.saveAs()è§¦å‘ä¸‹è½½
    â†“
å®Œæˆï¼ç”¨æˆ·è·å¾—ä¸“ä¸šæŠ¥å‘Š
```

### å›¾è¡¨è½¬å›¾ç‰‡

```typescript
// lib/chart-to-image.ts
import html2canvas from 'html2canvas';

/**
 * å°†Reactç»„ä»¶è½¬ä¸ºå›¾ç‰‡ï¼ˆç”¨äºæ’å…¥Wordï¼‰
 */
export async function chartToImage(elementId: string): Promise<Blob> {
  const element = document.getElementById(elementId);
  if (!element) throw new Error(`Element ${elementId} not found`);

  const canvas = await html2canvas(element, {
    backgroundColor: '#ffffff',
    scale: 2, // 2xåˆ†è¾¨ç‡
  });

  return new Promise((resolve) => {
    canvas.toBlob((blob) => {
      resolve(blob!);
    }, 'image/png');
  });
}

// ä½¿ç”¨ç¤ºä¾‹
const costPieChartImage = await chartToImage('cost-pie-chart');
const costBarChartImage = await chartToImage('cost-bar-chart');

// æ’å…¥Word
new ImageRun({
  data: await costPieChartImage.arrayBuffer(),
  transformation: {
    width: 400,
    height: 300,
  },
});
```

---

## 3.4 AIå¢å¼ºï¼šæˆ˜ç•¥å»ºè®®ç”Ÿæˆ

### Promptå·¥ç¨‹ï¼ˆå…³é”®ï¼‰

```typescript
/**
 * ç”Ÿæˆé«˜è´¨é‡ä¼˜åŒ–å»ºè®®çš„Promptæ¨¡æ¿
 */
const OPTIMIZATION_PROMPT_TEMPLATE = `ä½ æ˜¯GECOMå…¨çƒç”µå•†æˆæœ¬ä¼˜åŒ–ä¸“å®¶ï¼Œæ‹¥æœ‰10å¹´è·¨å¢ƒç”µå•†å®æˆ˜ç»éªŒã€‚

## ä½ çš„ä»»åŠ¡
åŸºäºä»¥ä¸‹æˆæœ¬åˆ†ææ•°æ®ï¼Œä¸ºå®¢æˆ·ç”Ÿæˆä¸“ä¸šã€å¯æ‰§è¡Œçš„ä¼˜åŒ–å»ºè®®ã€‚

## æ•°æ®è¾“å…¥
{DATA_PLACEHOLDER}

## è¾“å‡ºè¦æ±‚
è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡º4ä¸ªéƒ¨åˆ†çš„å»ºè®®ï¼Œæ¯éƒ¨åˆ†200-300å­—ï¼š

### 1. å®šä»·ç­–ç•¥ä¼˜åŒ–
- åˆ†æå½“å‰å®šä»·æ˜¯å¦åˆç†
- è®¡ç®—ç›®æ ‡å®šä»·ï¼ˆå®ç°30%æ¯›åˆ©ç‡ï¼‰
- è€ƒè™‘å¸‚åœºæ¥å—åº¦å’Œç«äº‰å®šä»·
- ç»™å‡ºå…·ä½“çš„å®šä»·å»ºè®®å’Œç†ç”±

### 2. æˆæœ¬å‰Šå‡è·¯å¾„
- è¯†åˆ«æœ€å¤§æˆæœ¬é©±åŠ¨å› ç´ 
- æä¾›3-5æ¡å…·ä½“å‰Šå‡å»ºè®®
- æ¯æ¡å»ºè®®åŒ…å«ï¼šç°çŠ¶ã€ä¼˜åŒ–æ–¹æ¡ˆã€é¢„æœŸèŠ‚çœ
- ä¼˜å…ˆè€ƒè™‘å¿«èµ¢é¡¹ï¼ˆ3ä¸ªæœˆå†…å¯è§æ•ˆï¼‰

### 3. å¸‚åœºé€‰æ‹©å»ºè®®
- è¯„ä¼°å½“å‰å¸‚åœºçš„ç«äº‰åŠ›
- å¯¹æ¯”æ›¿ä»£å¸‚åœºï¼ˆå¦‚æœæœ‰æ›´ä¼˜é€‰æ‹©ï¼‰
- è€ƒè™‘å‡†å…¥éš¾åº¦ã€è¿è¥æˆæœ¬ã€å¸‚åœºè§„æ¨¡
- ç»™å‡ºæ˜ç¡®çš„å¸‚åœºè¿›å…¥/é€€å‡ºå»ºè®®

### 4. å®æ–½è·¯çº¿å›¾
- çŸ­æœŸï¼ˆ0-3ä¸ªæœˆï¼‰ï¼šå¿«é€Ÿä¼˜åŒ–åŠ¨ä½œ
- ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰ï¼šç»“æ„æ€§è°ƒæ•´
- é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰ï¼šæˆ˜ç•¥æ€§è½¬å‹
- æ¯ä¸ªé˜¶æ®µåŒ…å«ï¼šç›®æ ‡ã€å…³é”®è¡ŒåŠ¨ã€é¢„æœŸç»“æœ

## è¾“å‡ºé£æ ¼
- ä¸“ä¸šä½†æ˜“æ‡‚ï¼Œé¿å…è¿‡åº¦æŠ€æœ¯æœ¯è¯­
- å…·ä½“å¯æ‰§è¡Œï¼ŒåŒ…å«æ•°å­—å’Œæ­¥éª¤
- å®¢è§‚ç†æ€§ï¼ŒåŸºäºæ•°æ®è€Œéä¸»è§‚åˆ¤æ–­
- ä¸­æ–‡è¾“å‡ºï¼Œä½¿ç”¨ä¸­æ–‡æ ‡ç‚¹ç¬¦å·

ç°åœ¨è¯·å¼€å§‹ç”Ÿæˆä¼˜åŒ–å»ºè®®ï¼š`;
```

---

## 3.5 æ•°æ®æº¯æºä¸è´¨é‡æ ‡è¯†

### åœ¨æŠ¥å‘Šä¸­æ ‡æ³¨æ•°æ®è´¨é‡

```typescript
/**
 * é™„å½•Bï¼šæ•°æ®æº¯æº
 */
function generateAppendixB(costFactor: CostFactor): Paragraph[] {
  return [
    new Paragraph({
      text: 'é™„å½•Bï¼šæ•°æ®æº¯æºä¸è´¨é‡è¯´æ˜',
      heading: HeadingLevel.HEADING_1,
      pageBreakBefore: true,
    }),

    new Paragraph({
      text: 'æ•°æ®è´¨é‡åˆ†çº§æ ‡å‡†',
      heading: HeadingLevel.HEADING_2,
    }),
    new Table({
      rows: [
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph('çº§åˆ«')] }),
            new TableCell({ children: [new Paragraph('æ¥æºç±»å‹')] }),
            new TableCell({ children: [new Paragraph('ç½®ä¿¡åº¦')] }),
            new TableCell({ children: [new Paragraph('ç¤ºä¾‹')] }),
          ],
        }),
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph({ text: 'Tier 1', color: '10B981' })] }),
            new TableCell({ children: [new Paragraph('å®˜æ–¹æ•°æ®')] }),
            new TableCell({ children: [new Paragraph('100%')] }),
            new TableCell({ children: [new Paragraph('ç¾å›½æµ·å…³å…³ç¨æ•°æ®ã€å„å›½æ”¿åºœVATç¨ç‡')] }),
          ],
        }),
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph({ text: 'Tier 2', color: 'F59E0B' })] }),
            new TableCell({ children: [new Paragraph('æƒå¨æ¥æº')] }),
            new TableCell({ children: [new Paragraph('90%')] }),
            new TableCell({ children: [new Paragraph('ç‰©æµå•†æŠ¥ä»·ã€è¡Œä¸šç ”ç©¶æŠ¥å‘Š')] }),
          ],
        }),
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph({ text: 'Tier 3', color: '6B7280' })] }),
            new TableCell({ children: [new Paragraph('ç»éªŒä¼°ç®—')] }),
            new TableCell({ children: [new Paragraph('80%')] }),
            new TableCell({ children: [new Paragraph('AIè°ƒç ”æ•°æ®ã€ä¸“å®¶ä¼°è®¡')] }),
          ],
        }),
      ],
    }),

    new Paragraph({
      text: 'æœ¬æŠ¥å‘Šæ•°æ®è´¨é‡æ¸…å•',
      heading: HeadingLevel.HEADING_2,
      spacing: { before: 300 },
    }),
    generateDataQualityList(costFactor),
  ];
}

function generateDataQualityList(costFactor: CostFactor): Table {
  return new Table({
    rows: [
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('æ¨¡å—')] }),
          new TableCell({ children: [new Paragraph('æ•°æ®é¡¹')] }),
          new TableCell({ children: [new Paragraph('æ•°æ®æ¥æº')] }),
          new TableCell({ children: [new Paragraph('è´¨é‡çº§åˆ«')] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('M1')] }),
          new TableCell({ children: [new Paragraph('ç›‘ç®¡æœºæ„')] }),
          new TableCell({ children: [new Paragraph('å®˜æ–¹æ”¿åºœç½‘ç«™')] }),
          new TableCell({ children: [new Paragraph(costFactor.m1_data_source)] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('M4')] }),
          new TableCell({ children: [new Paragraph('è¿›å£å…³ç¨ç¨ç‡')] }),
          new TableCell({ children: [new Paragraph('ç¾å›½æµ·å…³å®˜ç½‘')] }),
          new TableCell({ children: [new Paragraph(costFactor.m4_tariff_data_source)] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('M4')] }),
          new TableCell({ children: [new Paragraph('VAT/GSTç¨ç‡')] }),
          new TableCell({ children: [new Paragraph('å„å›½ç¨åŠ¡å±€å®˜ç½‘')] }),
          new TableCell({ children: [new Paragraph(costFactor.m4_vat_data_source)] }),
        ],
      }),
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph('M4')] }),
          new TableCell({ children: [new Paragraph('å¤´ç¨‹ç‰©æµè´¹ç‡')] }),
          new TableCell({ children: [new Paragraph('ä¸Šæµ·å¨ä¸‡å›½é™…ç‰©æµç­‰ç‰©æµå•†æŠ¥ä»·')] }),
          new TableCell({ children: [new Paragraph('tier2_authoritative')] }),
        ],
      }),
      // ... å…¶ä»–æ¨¡å—
    ],
  });
}
```

---

**ç¬¬ä¸‰éƒ¨åˆ†å®Œæˆæ£€æŸ¥ç‚¹**ï¼š
- âœ… æŠ¥å‘Šè´¨é‡æ ‡å‡†å®šä¹‰ï¼ˆå¯¹æ ‡ç›Šå®¶ä¹‹å® 30,000å­—ï¼‰
- âœ… æŠ¥å‘Šæ¨¡æ¿è®¾è®¡ï¼ˆä½¿ç”¨docx.jsï¼‰
- âœ… å®Œæ•´çš„9ç« ç»“æ„ä»£ç 
- âœ… å›¾è¡¨è½¬å›¾ç‰‡æ–¹æ¡ˆï¼ˆhtml2canvasï¼‰
- âœ… AIç”Ÿæˆä¼˜åŒ–å»ºè®®ï¼ˆDeepSeek R1ï¼‰
- âœ… æ•°æ®æº¯æºæ ‡è¯†ï¼ˆTier 1/2/3ï¼‰

---

# ç¬¬å››éƒ¨åˆ†ï¼šæ•°æ®å®Œæ•´æ€§ä¸è´¨é‡æå‡

## 4.1 å½“å‰æ•°æ®å®Œæ•´åº¦è¯„ä¼°

### å·²æœ‰æ•°æ®è¯„ä¼°ï¼ˆåŸºäº19å›½çœŸå®æ•°æ®ï¼‰

| æ¨¡å— | æ•°æ®å®Œæ•´åº¦ | æ•°æ®è´¨é‡ | è¦†ç›–å›½å®¶ | ç¼ºå¤±é¡¹ |
|------|-----------|---------|---------|--------|
| **M1 å¸‚åœºå‡†å…¥** | 80% | Tier 2 | 19å›½ | å…·ä½“æˆæœ¬é‡‘é¢ç¼ºå¤±ï¼ˆä»…æœ‰å¤æ‚åº¦è¯„çº§ï¼‰ |
| **M2 æŠ€æœ¯åˆè§„** | 20% | Tier 3 | 19å›½ | æ•°æ®ç¼ºå¤±ä¸¥é‡ï¼Œæœªä½¿ç”¨ |
| **M3 ä¾›åº”é“¾æ­å»º** | 100% | Tier 2 | 19å›½ | âœ… å®Œæ•´ï¼ˆå…¬å¼ï¼š2%ï¼‰ |
| **M4 å…³ç¨** | 100% | Tier 1 | 19å›½ | âœ… å®Œæ•´ |
| **M4 VAT** | 100% | Tier 1 | 19å›½ | âœ… å®Œæ•´ |
| **M4 ç‰©æµï¼ˆæµ·è¿ï¼‰** | 95% | Tier 2 | 19å›½ | éƒ¨åˆ†å›½å®¶è¿è¾“æ—¶é—´ç¼ºå¤± |
| **M4 ç‰©æµï¼ˆç©ºè¿ï¼‰** | 95% | Tier 2 | 19å›½ | éƒ¨åˆ†å›½å®¶è¿è¾“æ—¶é—´ç¼ºå¤± |
| **M5 å°¾ç¨‹é…é€** | 100% | Tier 2 | 19å›½ | âœ… å®Œæ•´ |
| **M5 é€†å‘ç‰©æµ** | 100% | Tier 2 | é€šç”¨ | âœ… å®Œæ•´ï¼ˆå…¬å¼ï¼‰ |
| **M6 è¥é”€è·å®¢** | 100% | Tier 2 | é€šç”¨ | âœ… å®Œæ•´ï¼ˆå…¬å¼ï¼š15%ï¼‰ |
| **M7 æ”¯ä»˜ç½‘å…³** | 100% | Tier 1 | é€šç”¨ | âœ… å®Œæ•´ï¼ˆStripeæ ‡å‡†ï¼‰ |
| **M7 å¹³å°ä½£é‡‘** | 100% | Tier 1/2 | 19å›½ | âœ… å®Œæ•´ |
| **M8 G&A** | 100% | Tier 2 | é€šç”¨ | âœ… å®Œæ•´ï¼ˆå…¬å¼ï¼š3%ï¼‰ |

### æ•°æ®è´¨é‡è¯„åˆ†

**æ•´ä½“è¯„åˆ†**: 87/100

**ä¼˜åŠ¿**ï¼š
- âœ… M4å…³ç¨å’ŒVATæ•°æ®100%æ¥è‡ªå®˜æ–¹æ¥æºï¼ˆTier 1ï¼‰
- âœ… 19å›½è¦†ç›–å®Œæ•´ï¼Œæ— é—æ¼
- âœ… M7å¹³å°ä½£é‡‘æ•°æ®çœŸå®å¯é 

**å¾…æå‡**ï¼š
- âš ï¸ M1å¸‚åœºå‡†å…¥ç¼ºå°‘å…·ä½“æˆæœ¬é‡‘é¢ï¼ˆä»…æœ‰å¤æ‚åº¦è¯„çº§ï¼‰
- âš ï¸ M2æŠ€æœ¯åˆè§„æ•°æ®ç¼ºå¤±ä¸¥é‡
- âš ï¸ M4ç‰©æµæ•°æ®æ¥è‡ªAIè°ƒç ”ï¼Œéç‰©æµå•†å®æ—¶æŠ¥ä»·

---

## 4.2 æ•°æ®è¡¥å…¨ä¼˜å…ˆçº§

### P0ï¼ˆå¿…é¡»è¡¥å…¨ï¼Œé˜»å¡MVPï¼‰

**æ— ** - å½“å‰æ•°æ®è¶³ä»¥æ”¯æŒMVP 2.0æ ¸å¿ƒåŠŸèƒ½

### P1ï¼ˆé‡è¦ï¼Œå½±å“å‡†ç¡®æ€§ï¼‰

1. **M1å¸‚åœºå‡†å…¥å…·ä½“æˆæœ¬**
   - å½“å‰çŠ¶æ€ï¼šåªæœ‰å¤æ‚åº¦è¯„çº§ï¼ˆæé«˜/é«˜/ä¸­/ä½ï¼‰
   - éœ€è¦è¡¥å……ï¼šå…·ä½“çš„å‡†å…¥æˆæœ¬é‡‘é¢ï¼ˆå…¬å¸æ³¨å†Œã€æ³•åŠ¡å’¨è¯¢ã€ç¨åŠ¡ç™»è®°ï¼‰
   - æ•°æ®æ¥æºï¼š
     - Tier 1: å„å›½å•†åŠ¡éƒ¨å®˜ç½‘ï¼ˆå¦‚ç¾å›½SBAï¼‰
     - Tier 2: ä»£ç†æœåŠ¡å•†æŠ¥ä»·ï¼ˆå¦‚LegalZoomã€æ³¨å†Œæ˜“ï¼‰
   - è¡¥å…¨æ–¹å¼ï¼š
     - ä¼˜å…ˆçº§1-5å›½ï¼šç¾å›½ã€å¾·å›½ã€è‹±å›½ã€æ—¥æœ¬ã€åŠ æ‹¿å¤§
     - ä¼˜å…ˆçº§6-10å›½ï¼šæ¾³æ´²ã€æ³•å›½ã€æ–°åŠ å¡ã€éŸ©å›½ã€æ²™ç‰¹
     - ä¼˜å…ˆçº§11-19å›½ï¼šå…¶ä»–å¸‚åœº
   - é¢„ä¼°æ—¶é—´ï¼š1-2å‘¨

2. **M4ç‰©æµå®æ—¶æŠ¥ä»·**
   - å½“å‰çŠ¶æ€ï¼šAIè°ƒç ”çš„å¹³å‡å€¼
   - éœ€è¦è¡¥å……ï¼šå¯¹æ¥çœŸå®ç‰©æµå•†APIè·å–å®æ—¶æŠ¥ä»·
   - æ•°æ®æ¥æºï¼š
     - Tier 2: ä¸Šæµ·å¨ä¸‡å›½é™…ç‰©æµï¼ˆå·²æœ‰è”ç³»ï¼‰
     - Tier 2: DHLã€FedExå…¬å¼€è¿è´¹è®¡ç®—å™¨
   - è¡¥å…¨æ–¹å¼ï¼šé›†æˆAPIæˆ–çˆ¬è™«å®šæœŸæ›´æ–°
   - é¢„ä¼°æ—¶é—´ï¼š2-3å‘¨

### P2ï¼ˆå¯é€‰ï¼Œæå‡ä¸“ä¸šåº¦ï¼‰

1. **M2æŠ€æœ¯åˆè§„æ•°æ®**
   - å½“å‰çŠ¶æ€ï¼šæ•°æ®ç¼ºå¤±ä¸¥é‡
   - éœ€è¦è¡¥å……ï¼šå„å›½äº§å“è®¤è¯è¦æ±‚å’Œæˆæœ¬
   - è¡¥å…¨æ–¹å¼ï¼š
     - æŒ‰è¡Œä¸šç»†åˆ†ï¼ˆå® ç‰©é£Ÿå“ã€ç”µå­çƒŸã€åŒ–å¦†å“ç­‰ï¼‰
     - ä¼˜å…ˆè¡¥å……é«˜ä»·å€¼å¸‚åœºï¼ˆç¾æ¬§ï¼‰
   - é¢„ä¼°æ—¶é—´ï¼š3-4å‘¨

2. **M1åˆè§„å¤æ‚åº¦é‡åŒ–**
   - å½“å‰çŠ¶æ€ï¼šå®šæ€§è¯„çº§ï¼ˆæé«˜/é«˜/ä¸­/ä½ï¼‰
   - éœ€è¦è¡¥å……ï¼šé‡åŒ–æŒ‡æ ‡ï¼ˆå®¡æ‰¹å‘¨æœŸã€æ‰€éœ€æ–‡ä»¶æ•°é‡ã€æˆåŠŸç‡ï¼‰
   - è¡¥å…¨æ–¹å¼ï¼šè°ƒç ”è¡Œä¸šæŠ¥å‘Šå’Œæ¡ˆä¾‹
   - é¢„ä¼°æ—¶é—´ï¼š2-3å‘¨

---

## 4.3 æ•°æ®æ”¶é›†æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®˜æ–¹æ•°æ®æºï¼ˆTier 1ï¼‰

**ç›®æ ‡æ•°æ®**ï¼šå…³ç¨ã€VATã€æ³•è§„
**æ•°æ®æº**ï¼š
- ç¾å›½æµ·å…³ï¼šhttps://hts.usitc.gov/
- æ¬§ç›ŸTARICï¼šhttps://ec.europa.eu/taxation_customs/dds2/taric/taric_consultation.jsp
- ä¸­å›½æµ·å…³ï¼šhttp://www.customs.gov.cn/
- å„å›½ç¨åŠ¡å±€ç½‘ç«™

**é‡‡é›†æ–¹å¼**ï¼š
```python
# scripts/scrape-tariff-data.py
import requests
from bs4 import BeautifulSoup

def scrape_us_tariff(hs_code):
    """ä»ç¾å›½æµ·å…³ç½‘ç«™æŠ“å–å…³ç¨æ•°æ®"""
    url = f"https://hts.usitc.gov/view?search={hs_code}"
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')

    tariff_rate = soup.find('td', {'class': 'tariff-rate'}).text
    return {
        'hs_code': hs_code,
        'tariff_rate': parse_rate(tariff_rate),
        'data_source': 'tier1_official',
        'source_url': url,
        'updated_at': datetime.now().isoformat()
    }
```

### æ–¹æ¡ˆ2ï¼šæƒå¨æ¥æºï¼ˆTier 2ï¼‰

**ç›®æ ‡æ•°æ®**ï¼šç‰©æµè´¹ç”¨ã€å¸‚åœºç ”ç©¶
**æ•°æ®æº**ï¼š
- ç‰©æµå•†APIï¼ˆDHLã€FedExã€ä¸Šæµ·å¨ä¸‡ï¼‰
- è¡Œä¸šæŠ¥å‘Šï¼ˆStatistaã€eMarketerï¼‰
- è·¨å¢ƒç”µå•†å¹³å°æ•°æ®

**é‡‡é›†æ–¹å¼**ï¼š
```typescript
// lib/logistics-api.ts
async function getShippingQuote(
  origin: string,
  destination: string,
  weight: number
): Promise<ShippingQuote> {
  // è°ƒç”¨ç‰©æµå•†API
  const response = await fetch('https://api.dhl.com/quote', {
    method: 'POST',
    headers: {
      'DHL-API-Key': process.env.DHL_API_KEY!,
    },
    body: JSON.stringify({
      originCountryCode: origin,
      destinationCountryCode: destination,
      weight: weight,
      // ...
    }),
  });

  const data = await response.json();

  return {
    usd_per_kg: data.ratePerKg,
    transit_days: data.estimatedDays,
    data_source: 'tier2_authoritative',
    provider: 'DHL',
    updated_at: new Date().toISOString(),
  };
}
```

### æ–¹æ¡ˆ3ï¼šç»éªŒä¼°ç®—ï¼ˆTier 3ï¼‰

**ç›®æ ‡æ•°æ®**ï¼šç¼ºå¤±çš„æˆæœ¬å‚æ•°
**æ•°æ®æº**ï¼š
- DeepSeek AIè°ƒç ”
- è¡Œä¸šä¸“å®¶è®¿è°ˆ
- å†å²é¡¹ç›®ç»éªŒ

**é‡‡é›†æ–¹å¼**ï¼š
```typescript
// lib/ai-research.ts
async function researchCostFactor(
  country: string,
  module: string,
  query: string
): Promise<CostFactorEstimate> {
  const prompt = `è¯·è°ƒç ”${country}çš„${module}æˆæœ¬æ•°æ®ï¼š${query}

è¦æ±‚ï¼š
1. ç»™å‡ºå…·ä½“æ•°å­—å’ŒèŒƒå›´
2. è¯´æ˜æ•°æ®æ¥æºå’Œå¯é æ€§
3. æ ‡æ³¨æ˜¯å¦ä¸ºä¼°ç®—å€¼

æ ¼å¼ï¼šJSONæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«valueã€rangeã€sourceã€confidenceå­—æ®µ`;

  const response = await callDeepSeekV3(prompt);

  return {
    ...JSON.parse(response),
    data_source: 'tier3_estimated',
    researched_at: new Date().toISOString(),
  };
}
```

---

## 4.4 æ•°æ®è´¨é‡åˆ†çº§ï¼ˆTier 1/2/3ï¼‰

### åˆ†çº§æ ‡å‡†

| çº§åˆ« | æ¥æºç±»å‹ | ç½®ä¿¡åº¦ | æ›´æ–°é¢‘ç‡ | ç¤ºä¾‹ |
|------|---------|--------|---------|------|
| **Tier 1** | å®˜æ–¹æ•°æ® | 100% | å­£åº¦/å¹´åº¦ | æµ·å…³å…³ç¨ã€æ”¿åºœç¨ç‡ã€å®˜æ–¹ç»Ÿè®¡ |
| **Tier 2** | æƒå¨æ¥æº | 90% | æœˆåº¦/å­£åº¦ | ç‰©æµå•†æŠ¥ä»·ã€è¡Œä¸šæŠ¥å‘Šã€ç¬¬ä¸‰æ–¹ç ”ç©¶ |
| **Tier 3** | ç»éªŒä¼°ç®— | 80% | ä¸å®šæœŸ | AIè°ƒç ”ã€ä¸“å®¶ä¼°è®¡ã€å†å²ç»éªŒ |

### æ•°æ®è´¨é‡ä¿è¯æµç¨‹

```
æ•°æ®æ”¶é›†
    â†“
è´¨é‡éªŒè¯ï¼ˆèŒƒå›´æ£€æŸ¥ã€é€»è¾‘éªŒè¯ï¼‰
    â†“
æ¥æºæ ‡è®°ï¼ˆTier 1/2/3ï¼‰
    â†“
å­˜å…¥æ•°æ®åº“ï¼ˆé™„å¸¦å…ƒæ•°æ®ï¼‰
    â†“
å®šæœŸå®¡æŸ¥ï¼ˆTier 3æ•°æ®ä¼˜å…ˆå‡çº§åˆ°Tier 2/1ï¼‰
    â†“
ç‰ˆæœ¬ç®¡ç†ï¼ˆæ–°æ•°æ®åˆ›å»ºæ–°ç‰ˆæœ¬ï¼Œæ—§æ•°æ®å½’æ¡£ï¼‰
```

### æ•°æ®æ›´æ–°ç­–ç•¥

**Tier 1æ•°æ®**ï¼š
- å…³ç¨ç¨ç‡ï¼šå­£åº¦æ£€æŸ¥ï¼Œé‡å¤§æ”¿ç­–å˜åŒ–æ—¶ç«‹å³æ›´æ–°
- VATç¨ç‡ï¼šå¹´åº¦æ£€æŸ¥
- æ›´æ–°æ–¹å¼ï¼šè‡ªåŠ¨çˆ¬è™« + äººå·¥å®¡æ ¸

**Tier 2æ•°æ®**ï¼š
- ç‰©æµè´¹ç”¨ï¼šæœˆåº¦æ›´æ–°ï¼ˆå¯¹æ¥APIè‡ªåŠ¨è·å–ï¼‰
- å¹³å°ä½£é‡‘ï¼šå­£åº¦æ£€æŸ¥å„å¹³å°è´¹ç‡è°ƒæ•´
- æ›´æ–°æ–¹å¼ï¼šAPIè°ƒç”¨ + äººå·¥éªŒè¯

**Tier 3æ•°æ®**ï¼š
- æŒç»­æ ‡æ³¨ä¸º"å¾…éªŒè¯"
- ä¼˜å…ˆçº§è¡¥å…¨è®¡åˆ’ï¼ˆé€æ­¥æ›¿æ¢ä¸ºTier 1/2æ•°æ®ï¼‰
- æ›´æ–°æ–¹å¼ï¼šäººå·¥è°ƒç ”

---

**ç¬¬å››éƒ¨åˆ†å®Œæˆæ£€æŸ¥ç‚¹**ï¼š
- âœ… å½“å‰æ•°æ®å®Œæ•´åº¦è¯„ä¼°ï¼ˆ87/100åˆ†ï¼‰
- âœ… æ•°æ®è¡¥å…¨ä¼˜å…ˆçº§ï¼ˆP0/P1/P2åˆ†çº§ï¼‰
- âœ… æ•°æ®æ”¶é›†æ–¹æ¡ˆï¼ˆå®˜æ–¹/æƒå¨/ä¼°ç®—ä¸‰å±‚ï¼‰
- âœ… æ•°æ®è´¨é‡åˆ†çº§æ ‡å‡†ï¼ˆTier 1/2/3ï¼‰
- âœ… æ•°æ®æ›´æ–°ç­–ç•¥

---

ï¼ˆæ–‡æ¡£ç¬¬ä¸‰åˆ°ç¬¬å››éƒ¨åˆ†å·²å®Œæˆï¼Œç¬¬äº”åˆ°ç¬¬ä¸ƒéƒ¨åˆ†å°†åœ¨ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¸­ç»§ç»­ï¼‰
