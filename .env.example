# GECOM智能成本助手环境变量配置

> **配置说明**：复制此文件为 `.env.local`，并填入实际的API密钥
> **安全提示**：`.env.local` 已在 `.gitignore` 中，不会提交到Git

---

## 📋 配置分类

### 🤖 AI 服务配置

#### Claude API（Anthropic）- 智能助手核心

```bash
# Claude API配置
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_MAX_TOKENS=4096
```

**获取方式**：
1. 访问 https://console.anthropic.com/
2. 创建API Key
3. 选择合适的模型（推荐 Claude 3.5 Sonnet）

**用途**：
- AI助手智能问答
- 成本优化建议生成
- 场景分析推荐

---

### 🗄️ Appwrite 配置

#### 前端配置（公开，打包到客户端）

```bash
# Appwrite端点和项目ID（可公开）
NEXT_PUBLIC_APPWRITE_ENDPOINT=https://cloud.appwrite.io/v1
NEXT_PUBLIC_APPWRITE_PROJECT=your_project_id_here

# 数据库配置
NEXT_PUBLIC_APPWRITE_DATABASE=gecom_database
NEXT_PUBLIC_APPWRITE_COLLECTION_PROJECTS=projects
NEXT_PUBLIC_APPWRITE_COLLECTION_CALCULATIONS=calculations
```

#### 服务端配置（私密，仅服务端使用）

```bash
# Appwrite管理员API密钥（私密！）
APPWRITE_API_KEY=standard_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 数据库详细配置
APPWRITE_DATABASE_ID=your_database_id_here
APPWRITE_COLLECTION_PROJECTS_ID=your_projects_collection_id
APPWRITE_COLLECTION_CALCULATIONS_ID=your_calculations_collection_id
```

**获取方式**：
1. 访问 https://cloud.appwrite.io/ 或自建Appwrite
2. 创建新项目
3. 创建Database和Collections
4. 生成API Key（Settings → API Keys → Create API Key）

**数据库结构**：

```
gecom_database/
├─ projects                     # 用户项目
│  ├─ id (string, unique)
│  ├─ userId (string)          # 关联用户
│  ├─ name (string)            # 项目名称
│  ├─ industry (string)        # 行业（pet/vape）
│  ├─ targetCountry (string)   # 目标市场
│  ├─ salesChannel (string)    # 销售渠道
│  ├─ createdAt (datetime)
│  └─ updatedAt (datetime)
│
└─ calculations                 # 成本计算结果
   ├─ id (string, unique)
   ├─ projectId (string)       # 关联项目
   ├─ scope (json)             # 完整输入数据
   ├─ costResult (json)        # 计算结果
   ├─ createdAt (datetime)
   └─ version (string)         # GECOM版本
```

---

### 🌍 可选配置

#### Unsplash API（图片配图，可选）

```bash
# Unsplash图片API（可选）
UNSPLASH_ACCESS_KEY=your_unsplash_access_key_here
```

**用途**：为报告生成封面图（如果需要PDF导出功能）

---

## 🚀 快速开始

### 本地开发

1. **复制配置文件**
   ```bash
   cp .env.example .env.local
   ```

2. **填入API密钥**
   - 至少配置 `ANTHROPIC_API_KEY`（AI功能）
   - 如需数据持久化，配置 Appwrite

3. **启动开发服务器**
   ```bash
   npm install
   npm run dev
   ```

### 部署到Appwrite Sites

1. **在Appwrite Sites配置环境变量**
   - 访问：https://cloud.appwrite.io/console
   - 项目 → Sites → 你的站点 → Settings → Variables

2. **添加所有 `NEXT_PUBLIC_*` 变量**
   ```
   NEXT_PUBLIC_APPWRITE_ENDPOINT
   NEXT_PUBLIC_APPWRITE_PROJECT
   NEXT_PUBLIC_APPWRITE_DATABASE
   等
   ```

3. **添加私密变量**
   ```
   ANTHROPIC_API_KEY
   APPWRITE_API_KEY
   等
   ```

---

## ⚙️ 环境变量说明

### 变量命名规则

| 前缀 | 作用域 | 安全性 | 示例 |
|------|--------|--------|------|
| `NEXT_PUBLIC_*` | 客户端 + 服务端 | 可公开 | `NEXT_PUBLIC_APPWRITE_ENDPOINT` |
| 无前缀 | 仅服务端 | 私密 | `ANTHROPIC_API_KEY` |

### 最小配置（POC测试）

仅需AI功能，无需数据持久化：

```bash
# 最小配置
ANTHROPIC_API_KEY=sk-ant-xxxxx
```

### 完整配置（生产环境）

包含数据持久化、用户认证：

```bash
# AI服务
ANTHROPIC_API_KEY=sk-ant-xxxxx

# Appwrite（完整）
NEXT_PUBLIC_APPWRITE_ENDPOINT=https://cloud.appwrite.io/v1
NEXT_PUBLIC_APPWRITE_PROJECT=your_project_id
NEXT_PUBLIC_APPWRITE_DATABASE=gecom_database
APPWRITE_API_KEY=standard_xxxxx
```

---

## 🔒 安全最佳实践

1. **永远不要提交 `.env.local` 到Git**
   - 已在 `.gitignore` 中配置

2. **使用环境变量**
   - ✅ 正确：`process.env.ANTHROPIC_API_KEY`
   - ❌ 错误：硬编码API密钥

3. **区分公开/私密变量**
   - `NEXT_PUBLIC_*` → 可以公开（会打包到客户端）
   - 无前缀 → 私密（仅服务端可访问）

4. **生产环境单独配置**
   - Appwrite Sites环境变量与本地分离
   - 不同环境使用不同的API Key

---

## 📚 相关文档

- [DEPLOYMENT.md](../DEPLOYMENT.md) - Appwrite部署指南
- [README.md](../../README.md) - 项目概览
- [Appwrite文档](https://appwrite.io/docs)
- [Claude API文档](https://docs.anthropic.com/)

---

**最后更新**: 2025-11-07
**维护者**: GECOM Team
