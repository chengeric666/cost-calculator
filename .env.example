# GECOM智能成本助手环境变量配置

> **配置说明**：复制此文件为 `.env.local`，并填入实际的API密钥
> **安全提示**：`.env.local` 已在 `.gitignore` 中，不会提交到Git

---

## 📋 配置分类

### 🤖 AI 服务配置

#### DeepSeek API（AI智能助手核心）

```bash
# DeepSeek LLM 配置
LLM_BASE_URL=https://llm.chutes.ai/v1
LLM_API_KEY=cpk_513bbeacccc54947a01e753e42a9e5f3.0ff351163a135c8687662b0c073a786a.vhDBL1gTsrSjlsAiWQjdf3bxOHAhXv8h
MODEL_REASON=deepseek-ai/DeepSeek-R1      # 纯推理/对话模型
MODEL_TOOLCALL=deepseek-ai/DeepSeek-V3    # 工具调用模型
LLM_PROVIDER=deepseek
```

**用途**：
- AI助手智能问答
- 成本优化建议生成
- 场景分析推荐
- 多SKU对比分析

**模型说明**：
- `DeepSeek-R1`：适用于复杂推理和对话场景
- `DeepSeek-V3`：支持工具调用和函数调用

---

### 🗄️ Appwrite 配置

#### 前端配置（公开，打包到客户端）

```bash
# Appwrite端点和项目ID（可公开）
NEXT_PUBLIC_APPWRITE_ENDPOINT=https://apps.aotsea.com/v1
NEXT_PUBLIC_APPWRITE_PROJECT=690d4f580002dcbcb575

# 数据库配置
NEXT_PUBLIC_APPWRITE_DATABASE=690d4fdd0035c2f63f20
NEXT_PUBLIC_APPWRITE_COLLECTION_PROJECTS=projects
NEXT_PUBLIC_APPWRITE_COLLECTION_CALCULATIONS=calculations
```

#### 服务端配置（私密，仅服务端使用）
```bash
# Appwrite管理员API密钥（私密！）
APPWRITE_API_KEY=standard_050c6ae6a2d7e3bd394a10b68d447bef450f076cf508d2f8ea42dff322a7f56b92674cf4ffbc6cac352606a22f647aa35db8434b485dead73e569e7c6a62feb228443c5dc5d57ac44549654450e34cfa5984536455474573f3c34a9bcd1c4eae596fc1b91287c7dbc56c26dcd3ce6d57f58d22baec52bf90baff0b947e37cece

# 数据库详细配置（通常与NEXT_PUBLIC_变量相同）
APPWRITE_DATABASE_ID=690d4fdd0035c2f63f20
APPWRITE_COLLECTION_PROJECTS_ID=projects
APPWRITE_COLLECTION_CALCULATIONS_ID=calculations
```

**获取方式**：
1. 访问 https://apps.aotsea.com/console
2. 选择项目或创建新项目
3. 创建Database和Collections
4. 生成API Key（Settings → API Keys → Create API Key）

**数据库结构**：

```
gecom_database (690d4fdd0035c2f63f20)/
├─ projects                     # 用户项目
│  ├─ id (string, unique)
│  ├─ userId (string)          # 关联用户
│  ├─ name (string)            # 项目名称
│  ├─ industry (string)        # 行业（pet/vape）
│  ├─ targetCountry (string)   # 目标市场
│  ├─ salesChannel (string)    # 销售渠道
│  ├─ createdAt (datetime)
│  └─ updatedAt (datetime)
│
└─ calculations                 # 成本计算结果
   ├─ id (string, unique)
   ├─ projectId (string)       # 关联项目
   ├─ scope (json)             # 完整输入数据
   ├─ costResult (json)        # 计算结果
   ├─ createdAt (datetime)
   └─ version (string)         # GECOM版本
```

---

### 🌍 可选配置

#### Unsplash API（图片配图，可选）

```bash
# Unsplash图片API（可选）
UNSPLASH_ACCESS_KEY=b8xl0xVUL9DH2xbOOq0szT6bFZqUZbqp98HXvdv-h6E
```

**用途**：为报告生成封面图（如果需要PDF导出功能）

**获取方式**：
1. 访问 https://unsplash.com/developers
2. 创建应用获取Access Key

---

## 🚀 快速开始

### 本地开发

1. **复制配置文件**
   ```bash
   cp .env.example .env.local
   ```

2. **验证配置**
   - AI功能已配置（DeepSeek API）
   - 数据持久化已配置（Appwrite）
   - 可直接使用

3. **启动开发服务器**
   ```bash
   npm install
   npm run dev
   ```

4. **访问应用**
   ```
   http://localhost:3000
   ```

### 部署到Appwrite Sites

1. **在Appwrite Sites配置环境变量**
   - 访问：https://apps.aotsea.com/console
   - 项目 → Sites → 你的站点 → Settings → Variables

2. **添加所有 `NEXT_PUBLIC_*` 变量**
   ```
   NEXT_PUBLIC_APPWRITE_ENDPOINT=https://apps.aotsea.com/v1
   NEXT_PUBLIC_APPWRITE_PROJECT=690d4f580002dcbcb575
   NEXT_PUBLIC_APPWRITE_DATABASE=690d4fdd0035c2f63f20
   NEXT_PUBLIC_APPWRITE_COLLECTION_PROJECTS=projects
   NEXT_PUBLIC_APPWRITE_COLLECTION_CALCULATIONS=calculations
   ```

3. **添加私密变量**
   ```
   LLM_BASE_URL=https://llm.chutes.ai/v1
   LLM_API_KEY=cpk_513bbeacccc54947a01e753e42a9e5f3...
   MODEL_REASON=deepseek-ai/DeepSeek-R1
   MODEL_TOOLCALL=deepseek-ai/DeepSeek-V3
   LLM_PROVIDER=deepseek
   APPWRITE_API_KEY=standard_050c6ae6a2d7e3bd394a10b68d447bef...
   ```

---

## ⚙️ 环境变量说明

### 变量命名规则

| 前缀 | 作用域 | 安全性 | 示例 |
|------|--------|--------|------|
| `NEXT_PUBLIC_*` | 客户端 + 服务端 | 可公开 | `NEXT_PUBLIC_APPWRITE_ENDPOINT` |
| 无前缀 | 仅服务端 | 私密 | `LLM_API_KEY`, `APPWRITE_API_KEY` |

### 最小配置（POC测试）

仅需AI功能，无需数据持久化：

```bash
# 最小配置
LLM_BASE_URL=https://llm.chutes.ai/v1
LLM_API_KEY=cpk_513bbeacccc54947a01e753e42a9e5f3.0ff351163a135c8687662b0c073a786a.vhDBL1gTsrSjlsAiWQjdf3bxOHAhXv8h
MODEL_REASON=deepseek-ai/DeepSeek-R1
LLM_PROVIDER=deepseek
```

### 完整配置（生产环境）

包含数据持久化、用户认证：

```bash
# AI服务
LLM_BASE_URL=https://llm.chutes.ai/v1
LLM_API_KEY=cpk_513bbeacccc54947a01e753e42a9e5f3.0ff351163a135c8687662b0c073a786a.vhDBL1gTsrSjlsAiWQjdf3bxOHAhXv8h
MODEL_REASON=deepseek-ai/DeepSeek-R1
MODEL_TOOLCALL=deepseek-ai/DeepSeek-V3
LLM_PROVIDER=deepseek

# Appwrite（完整）
NEXT_PUBLIC_APPWRITE_ENDPOINT=https://apps.aotsea.com/v1
NEXT_PUBLIC_APPWRITE_PROJECT=690d4f580002dcbcb575
NEXT_PUBLIC_APPWRITE_DATABASE=690d4fdd0035c2f63f20
APPWRITE_API_KEY=standard_050c6ae6a2d7e3bd394a10b68d447bef...

# 可选
UNSPLASH_ACCESS_KEY=b8xl0xVUL9DH2xbOOq0szT6bFZqUZbqp98HXvdv-h6E
```

---

## 🔒 安全最佳实践

1. **永远不要提交 `.env.local` 到Git**
   - 已在 `.gitignore` 中配置

2. **使用环境变量**
   - ✅ 正确：`process.env.LLM_API_KEY`
   - ❌ 错误：硬编码API密钥

3. **区分公开/私密变量**
   - `NEXT_PUBLIC_*` → 可以公开（会打包到客户端）
   - 无前缀 → 私密（仅服务端可访问）

4. **生产环境单独配置**
   - Appwrite Sites环境变量与本地分离
   - 不同环境使用不同的API Key（如有必要）

5. **API密钥轮换**
   - 定期更新生产环境API密钥
   - 泄露后立即撤销并重新生成

---

## 📚 相关文档

- [DEPLOYMENT.md](./DEPLOYMENT.md) - Appwrite部署指南
- [README.md](./README.md) - 项目概览
- [Appwrite文档](https://appwrite.io/docs)
- [DeepSeek API文档](https://platform.deepseek.com/docs)

---

## 🔧 故障排除

### Q1: DeepSeek API连接失败

**检查步骤**：
1. 验证 `LLM_BASE_URL` 是否正确
2. 验证 `LLM_API_KEY` 是否有效
3. 检查网络连接

### Q2: Appwrite连接错误

**检查步骤**：
1. 确认 `NEXT_PUBLIC_APPWRITE_ENDPOINT` 可访问
2. 验证 `NEXT_PUBLIC_APPWRITE_PROJECT` 存在
3. 检查 Database ID 和 Collection ID 是否正确

### Q3: 环境变量未生效

**解决方案**：
- 本地开发：重启开发服务器 (`npm run dev`)
- 生产环境：重新部署触发构建

---

**最后更新**: 2025-11-07
**维护者**: GECOM Team
**配置版本**: v1.0 (DeepSeek + Appwrite)
